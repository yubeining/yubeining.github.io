---
title: mq
date: 2025-04-19
updated: 2025-04-19
categories: java
tags:
  - java
  - 笔记
top: 1
---

# MQ

### 1、使用MQ场景

#### 异步任务处理

当项目需要处理一些耗时的任务。通过将任务放入消息队列中，让应用程序快速响应请求，并将任务交给后台的工作线程来处理

#### 解耦系统组件

当系统中不同组件需要进行通信时，使用MQ实现解耦。每个组件可以通过消息队列发送和接收消息，而不需要直接依赖其他组件。

#### 数据传输

当需要将数据从一个应用程序传输到另一个应用程序，使用MQ，从而避免直接依赖网络和数据传输的稳定性

#### 消息通知

当需要通知多个应用程序或者用户，可以使用MQ来发送通知消息，从而实现消息的广播和通知功能





### 2、介绍MQ

#### 缺点

降低系统的可用性：系统引入的外部依赖越多，越容易挂掉

系统复杂度提高：使用MQ后可能需要保障消息没有被重复消费、处理消息丢失的情况、保证消息传递的顺序性等问题

一致性问题：写库操作失败导致数据不一致





### 3、负载均衡

#### 生产者端负载均衡

生产者将消息发送到多个队列中，这些队列可以在多个MQ节点进行分布，通过在发送消息时随机选择或轮询选择不同的队列

#### 消费者端负载均衡

MQ 提供了多个消费者订阅同一个队列的功能。当有消息到达队列时，MQ 将消息分发给其中一个消费者进行处理。通过增加多个消费者来订阅队列，可以实现消费者端的负载均衡。



### 4、保证MQ消息不丢失

生产者弄丢了消息：开启confirm模式

mq弄丢消息：开启broker持久化

消费者弄丢消息：关闭自动ack，手动ack



### 5、保证MQ接受消息顺序性

分区排序：将消息按照某个分区规则进行分区，每个分区由一个独立的消费者来处理

全局排序：如果业务对于消息的严格顺序要求非常高，可以考虑使用全局排序的机制，确保消息在整个MQ集群中按照顺序处理。



同一个订单号的消息发送到同一个queue中，同一个队列的消息一定会保证有序



### 6、重复消费问题

每条消息设置一个唯一的标识id

幂等方案：分布式锁、数据库锁

